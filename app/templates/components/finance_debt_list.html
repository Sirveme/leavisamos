<div class="space-y-6 mt-4 fade-me-in">
    
    <!-- 1. DEUDAS PENDIENTES -->
    <div>
        <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 border-b border-slate-700/50 pb-1">
            Por Pagar
        </h4>
        <div class="space-y-2">
            {% for debt in debts %}
            <div class="flex justify-between items-center p-3 rounded-lg border bg-slate-800 {{ 'border-slate-700 opacity-50' if debt.status == 'paid' else 'border-l-4 border-l-red-500 shadow-sm' }}">
                <div>
                    <p class="text-sm font-bold text-slate-200">{{ debt.concept }}</p>
                    <p class="text-[10px] text-slate-400">
                        Vence: {{ debt.due_date.strftime('%d/%m') if debt.due_date else 'N/A' }}
                    </p>
                </div>
                <div class="text-right">
                    {% if debt.status == 'paid' %}
                        <span class="text-emerald-500 text-xs font-bold flex items-center justify-end gap-1">
                            <i class="ph ph-check-circle"></i> PAGADO
                        </span>
                    {% else %}
                        <span class="text-white font-mono text-sm font-bold">S/ {{ "{:,.2f}".format(debt.balance) }}</span>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <p class="text-xs text-slate-500 italic text-center py-2">No tienes deudas pendientes.</p>
            {% endfor %}
        </div>
    </div>

    <!-- 2. HISTORIAL DE REPORTES -->
    <div>
        <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 border-b border-slate-700/50 pb-1">
            Historial de Pagos
        </h4>
        <div class="space-y-3">
            {% for pay in payments %}
            <div class="p-3 rounded-lg border bg-slate-800 relative mb-2 {{ 'border-red-500' if pay.status == 'rejected' else 'border-slate-700' }}">
                
                <!-- Cabecera -->
                <div class="flex justify-between items-start mb-1">
                    <span class="font-mono font-bold text-white">S/ {{ "{:,.2f}".format(pay.amount) }}</span>
                    {% if pay.status == 'rejected' %}
                        <span class="text-[10px] bg-red-600 text-white px-2 py-0.5 rounded font-bold uppercase tracking-wider">Rechazado</span>
                    {% elif pay.status == 'approved' %}
                        <span class="text-[10px] text-emerald-400 font-bold flex items-center gap-1"><i class="ph ph-check"></i> Aprobado</span>
                    {% else %}
                        <span class="text-[10px] text-yellow-500 font-bold"><i class="ph ph-clock"></i> Revisión</span>
                    {% endif %}
                </div>

                <!-- Detalles y Fecha -->
                <div class="flex justify-between items-end">
                    <div>
                        <!-- Fecha Local (Script Global) -->
                        <p class="text-[10px] text-slate-400 local-time" data-date="{{ pay.created_at.isoformat() }}">
                            --:--
                        </p>
                        <p class="text-[10px] text-slate-500">{{ pay.payment_method }}</p>
                    </div>
                </div>

                <!-- SECCIÓN MOTIVO DE RECHAZO (BLINDADA) -->
                {% if pay.status == 'rejected' %}
                <div class="mt-3 bg-red-950/50 border border-red-500/30 p-2 rounded text-xs text-red-200 flex gap-2 items-start animate-pulse">
                    <i class="ph ph-warning-circle mt-0.5 text-red-500 shrink-0"></i>
                    <div>
                        <strong class="block text-red-400 mb-0.5">Motivo:</strong>
                        {{ pay.rejection_reason or "Sin detalle especificado." }}
                    </div>
                </div>
                {% endif %}

            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Re-activar script de fechas para contenido nuevo cargado por HTMX -->
<script>
    if(window.renderLocalTimes) window.renderLocalTimes(document.body);
</script>