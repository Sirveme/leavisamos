{% extends "base.html" %}

{% block content %}
<div class="flex flex-col h-full gap-4">

    <!-- 1. CABECERA ALERTA (Status) -->
    <div id="status-box" class="bg-slate-800 border border-slate-600 p-3 rounded-xl text-center transition-colors duration-500 shrink-0">
        <h1 class="text-lg font-bold text-slate-200"><i class="ph ph-shield-check mr-2"></i>CENTINELA</h1>
        <p id="status-text" class="text-xs text-slate-400">Sistema Activo</p>
        <button id="btn-silenciar" onclick="silenciarAlarma()" class="hidden mt-2 bg-white text-red-600 px-4 py-1 rounded-full text-sm font-bold animate-bounce">
            ATENDER ALERTA
        </button>
    </div>

    <!-- CONTENEDOR GRID (Para Tablet/PC) -->
    <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4 overflow-hidden">
        
        <!-- COLUMNA IZQUIERDA: BITÃCORA EN VIVO -->
        <div class="bg-black rounded-xl p-3 flex flex-col border border-slate-800 h-full overflow-hidden">
            <div class="text-[10px] text-slate-500 mb-2 uppercase tracking-wider">Eventos en Tiempo Real</div>
            <div id="security-log" class="overflow-y-auto flex-1 font-mono text-xs space-y-2 pr-2">
                <!-- AquÃ­ caen las alertas y registros -->
            </div>
        </div>

        <!-- COLUMNA DERECHA: PANEL DE ACCIÃ“N -->
        <div class="bg-slate-900 rounded-xl p-4 flex flex-col border border-slate-800 overflow-y-auto">
            
            <!-- A. VALIDACIÃ“N VISUAL (Buscador) -->
            <div class="mb-6">
                <label class="text-xs text-indigo-400 font-bold uppercase mb-2 block">Validar Residente / Unidad</label>
                <div class="flex gap-2">
                    <input type="text" name="query" 
                           class="w-full bg-slate-800 border border-slate-700 text-white rounded px-3 py-2 text-sm focus:border-indigo-500 outline-none"
                           placeholder="Ej: 501, Juan..."
                           hx-post="/centinela/search" 
                           hx-trigger="keyup changed delay:500ms" 
                           hx-target="#search-results">
                </div>
                <!-- Resultados de bÃºsqueda -->
                <div id="search-results" class="mt-3 max-h-40 overflow-y-auto"></div>
            </div>

            <hr class="border-slate-800 mb-6">

            <!-- B. REGISTRO RÃPIDO -->
            <form hx-post="/centinela/log" hx-target="#security-log" hx-swap="afterbegin" onsubmit="limpiarForm()">
                <label class="text-xs text-green-400 font-bold uppercase mb-2 block">Registro de Ingreso</label>
                
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <label class="cursor-pointer">
                        <input type="radio" name="tipo" value="DELIVERY" class="peer hidden" checked>
                        <div class="bg-slate-800 peer-checked:bg-orange-600 peer-checked:text-white text-slate-400 py-2 px-4 rounded text-center text-sm border border-slate-700 transition-all">
                            ðŸ›µ Delivery
                        </div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="tipo" value="VISITA" class="peer hidden">
                        <div class="bg-slate-800 peer-checked:bg-blue-600 peer-checked:text-white text-slate-400 py-2 px-4 rounded text-center text-sm border border-slate-700 transition-all">
                            ðŸ‘¤ Visita
                        </div>
                    </label>
                </div>

                <div class="space-y-3">
                    <input type="text" id="input-unidad" name="unidad" placeholder="Unidad (Ej: 501)" required
                           class="w-full bg-slate-800 border border-slate-700 text-white rounded px-3 py-2 text-sm">
                    
                    <input type="text" id="input-detalle" name="detalle" placeholder="Nombre / Empresa / DNI" required
                           class="w-full bg-slate-800 border border-slate-700 text-white rounded px-3 py-2 text-sm">
                    
                    <button type="submit" class="w-full bg-slate-700 hover:bg-slate-600 text-white py-3 rounded font-bold transition-colors">
                        REGISTRAR INGRESO
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- ConfiguraciÃ³n mÃ­nima -->
<script>
    window.APP_CONFIG = {
        wsUrl: (window.location.protocol === 'https:' ? 'wss:' : 'ws:') + '//' + window.location.host + '/ws/alerta'
    };
</script>

<script src="/static/js/pages/home_security.js"></script>

{% endblock %}